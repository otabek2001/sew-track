{% extends 'base.html' %}
{% load static %}

{% block title %}Statusni qaytarish{% if tenant %} - {{ tenant.name }}{% endif %}{% endblock %}

{% block content %}
<!-- Admin Navigation -->
{% include 'admin_panel/components/_admin_nav.html' %}

<div class="min-h-screen bg-gray-50 pb-20 md:pb-8">
    <!-- Header -->
    <header class="bg-white border-b sticky top-0 z-40 shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center gap-3">
                <a href="{% url 'admin_panel:work_records_list' %}" class="text-gray-600">
                    <i data-lucide="arrow-left" class="w-6 h-6"></i>
                </a>
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">Statusni qaytarish</h1>
                    <p class="text-sm text-gray-500">{{ tenant.name }}</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-6">
        <div class="max-w-2xl mx-auto">
            <!-- Warning Card -->
            <div class="bg-orange-50 border-2 border-orange-200 rounded-xl p-6 mb-6">
                <div class="flex items-start gap-3">
                    <i data-lucide="alert-triangle" class="w-6 h-6 text-orange-600 mt-0.5"></i>
                    <div>
                        <h3 class="font-bold text-orange-900 mb-2">Diqqat!</h3>
                        <p class="text-sm text-orange-800">
                            Siz bu yozuvning statusini <strong>pending</strong>'ga qaytarmoqchisiz. 
                            Bu yozuv master tomonidan 
                            {% if record.status == 'approved' %}
                            <strong class="text-green-700">tasdiqlangan</strong>
                            {% else %}
                            <strong class="text-red-700">rad etilgan</strong>
                            {% endif %}.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Record Info -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Yozuv ma'lumotlari</h3>
                
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Sana:</span>
                        <span class="text-sm font-medium text-gray-900">{{ record.work_date|date:"d.m.Y" }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Xodim:</span>
                        <span class="text-sm font-medium text-gray-900">{{ record.employee.full_name }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Mahsulot:</span>
                        <span class="text-sm font-medium text-gray-900">{{ record.product.name }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Operatsiya:</span>
                        <span class="text-sm font-medium text-gray-900">{{ record.task.name_uz }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Miqdor:</span>
                        <span class="text-sm font-medium text-gray-900">{{ record.quantity }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Jami to'lov:</span>
                        <span class="text-sm font-medium text-gray-900">{{ record.total_payment|floatformat:0 }} so'm</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Hozirgi status:</span>
                        {% if record.status == 'approved' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Tasdiqlangan
                        </span>
                        {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                            Rad etilgan
                        </span>
                        {% endif %}
                    </div>
                    {% if record.approved_by %}
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Tasdiqlagan:</span>
                        <span class="text-sm font-medium text-gray-900">{{ record.approved_by.full_name }}</span>
                    </div>
                    {% endif %}
                    {% if record.approved_at %}
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Tasdiqlangan vaqti:</span>
                        <span class="text-sm font-medium text-gray-900">{{ record.approved_at|date:"d.m.Y H:i" }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Reset Form -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Statusni qaytarish</h3>
                
                <form method="post" class="space-y-4">
                    {% csrf_token %}
                    
                    <div>
                        <label for="reason" class="block text-sm font-medium text-gray-700 mb-2">
                            Sabab (ixtiyoriy)
                        </label>
                        <textarea 
                            id="reason"
                            name="reason"
                            rows="4"
                            placeholder="Nima uchun statusni qaytarmoqchisiz? (masalan: Master xato qilgan, qayta ko'rib chiqish kerak, va hokazo...)"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-4 focus:ring-blue-100 focus:outline-none transition"
                        ></textarea>
                        <p class="mt-1 text-xs text-gray-500">
                            Sabab yozuvning notes qismiga qo'shiladi va audit trail sifatida saqlanadi.
                        </p>
                    </div>

                    <div class="flex gap-3 pt-4">
                        <button 
                            type="submit"
                            class="flex-1 bg-orange-600 hover:bg-orange-700 text-white font-medium py-3 px-6 rounded-lg transition flex items-center justify-center gap-2"
                        >
                            <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                            <span>Statusni qaytarish</span>
                        </button>
                        <a 
                            href="{% url 'admin_panel:work_records_list' %}"
                            class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-6 rounded-lg transition flex items-center justify-center gap-2"
                        >
                            <i data-lucide="x" class="w-5 h-5"></i>
                            <span>Bekor qilish</span>
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
});
</script>
{% endblock %}

